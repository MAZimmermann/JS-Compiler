<!DOCTYPE HTML>
<html>

<!--
index.html
main page for interacting with compiler
-->

<head>
    <title>MAZ Compiler</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" href="Skeleton/css/skeleton.css" />
    <link rel="stylesheet" href="Skeleton/css/normalize.css" />
</head>

<body onload="init();">

    <div class="container">

        <section class="header">
            <h1 class="title">MAZ's Compiler Project</h1>
            <input class="button-primary" type="button" value="Compile" onClick="compile();">
        </section>

        <br>

        <div class="row">
            <div class="six columns" height="250px">
                <label for="taInput">Source Program</label>
                <textarea id="taInput" class="u-full-width" placeholder="Enter Source Code..."></textarea>
            </div>

            <div class="six columns" height="250px">
                <label for="parseOutput">Parser Output</label>
                <textarea id="parseOutput" class="u-full-width" placeholder=""></textarea>
            </div>
        </div>

        <br>

        <!-- text area for viewing the contents of each line assessed by the lexer -->
        <div class="row">
            <div class="twelve columns" height="250px">
                <label for="lexOutput">Lexer Output</label>
                <textarea id="lexOutput" class="u-full-width" placeholder=""></textarea>
            </div>
        </div>

    </div>

    <script type="text/javascript" src="Scripts/tokens.js"></script>
    <script type="text/javascript" src="Scripts/utils.js"></script>
    <script type="text/javascript" src="Scripts/lexer.js"></script>
    <script type="text/javascript" src="Scripts/parser.js"></script>
    <script type="text/javascript" src="Scripts/cst.js"></script>
    <script type="text/javascript">
        // Declare and define global variables
        var tokens = [];
        var errors = [];
        var warnings = [];

        // Initialization function triggered onload
        function init() {
            // Start with blank lexOutput
            document.getElementById("taInput").placeholder = "Enter Source Code...";
            document.getElementById("lexOutput").value = "";
            document.getElementById("parseOutput").value = "";
            // Set initial values for global variables
            // var tokens = "";
            // ...
        }

        function compile() {
            init();
            // Get tokens from the lexer
            var lexReturns = lex();
            if (lexReturns.errorCount == 0) {
                // No errors in lex, continue to parse
                warnings = lexReturns.warningArray;
                var warningCount = lexReturns.warningCount;
                document.getElementById("lexOutput").value += "\n";
                document.getElementById("lexOutput").value += "Found " + warningCount + " warning(s)" + "\n";
                for (var i = 0; i < warningCount; i++) {
                    document.getElementById("lexOutput").value += warnings[i] + "\n";
                }

                document.getElementById("lexOutput").value += "Found 0 error(s)" + "\n";

                tokens = lexReturns.tokenArray;
                var parseReturns = parse(tokens, 0);
                var cst = parseReturns.cstArray[0];
                var tree = cst.toString();
                document.getElementById("parseOutput").value += tree;

            } else {
                // Errors in lex, halt compiler
                warnings = lexReturns.warningArray;
                var warningCount = lexReturns.warningCount;
                document.getElementById("lexOutput").value += "\n";
                document.getElementById("lexOutput").value += "Found " + warningCount + " warning(s)" + "\n";
                for (var i = 0; i < warningCount; i++) {
                    document.getElementById("lexOutput").value += warnings[i] + "\n";
                }

                errors = lexReturns.errorArray;
                var errorCount = lexReturns.errorCount;
                document.getElementById("lexOutput").value += "\n";
                document.getElementById("lexOutput").value += "Found " + errorCount + " error(s)" + "\n";
                for (var i = 0; i < errorCount; i++) {
                    document.getElementById("lexOutput").value += errors[i] + "\n";
                }
            }
        }

    </script>

</body>
</html>
